pipeline {
    agent { label 'docker1' }
 environment {
 report_file="${WORKSPACE}/report"
 COMPILER="${COMP_NAME}"
 USER=credentials('DOCKERHUB_USER')
 PASS=credentials('DOCKERHUB_PASSWORD')	
	}  
stages {
		stage(bash) {
		steps {
		sh '''
		if [[ "$COMPILER" == "bash" ]] || [[ "$COMPILER" == "all" ]]; then
		echo "creating dockerfile for bash code"
	        cd ${WORKSPACE}
	        echo "FROM ubuntu" > Dockerfile" >> Dockerfile
	        echo "RUN mkdir /home/doron && cd /home/doron" >> Dockerfile
		echo "COPY ./scripts/bash.sh /home/doron" >> Dockerfile
	        echo "WORKDIR /home/doron" >> Dockerfile
	        echo "CMD bash /home/doron/bash.sh >> Dockerfile
		echo "building bash docker image" 
		echo "building bash docker image" >> ${report_file}
		docker build -t bashimg:${BUILD_NUMBER} . && docker run bashimg:${BUILD_NUMBER}
		fi'''         	
		}
	 	}
	    stage(python) {
	       steps {
	       sh ''' 
	       if [ "$COMPILER" = "python" ]; then
               echo "creating docker imagefile for bash file"
	       cd ${WORKSPACE}
	       echo "FROM python:3.7-alpine" > Dockerfile
	       echo "COPY ./scripts/python.py /app" >> Dockerfile
	       echo "WORKDIR /app" >> Dockerfile
	       echo "CMD python /app/python.py" >> Dockerfile
	       echo "running python file" 
	       echo "running python file" >> ${report_file}
	       python ${WORKSPACE}/scripts/pyfile.py
	       fi'''       
		 }
		 }	
   	
        }
        }
